<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Punto Principal Telecom</title>
    <style>
        :root { --primary: #004a99; --claro: #ef3340; --directv: #00A1DE; --success: #28a745; }
        body { font-family: sans-serif; margin: 10px; background: #f4f7f6; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { text-align: center; color: var(--primary); border-bottom: 2px solid var(--primary); margin-bottom: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        input, select { padding: 10px; border: 1px solid #ccc; border-radius: 5px; width: 100%; box-sizing: border-box; }
        .btn { background: var(--primary); color: white; padding: 15px; border: none; width: 100%; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .search-box { margin: 20px 0; }
        #buscarInput { border: 2px solid var(--primary); padding: 12px; border-radius: 25px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
        th { background: #eee; padding: 10px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #ddd; }
        .badge { padding: 3px 8px; border-radius: 4px; color: white; font-weight: bold; font-size: 0.8em; }
    </style>
</head>
<body>

<div class="container">
    <div class="header"><h1>PUNTO PRINCIPAL TELECOM</h1></div>
    
    <div id="status" style="display:none; background:#d1ecf1; padding:10px; text-align:center; margin-bottom:10px;">Cargando datos...</div>

    <div class="form-grid">
        <select id="empresa"><option value="DIRECTV">DIRECTV</option><option value="CLARO">CLARO</option></select>
        <input type="text" id="cedula" placeholder="CÃ©dula">
        <input type="text" id="nombre" placeholder="Nombre Cliente">
        <input type="text" id="tel" placeholder="TelÃ©fono">
        <input type="text" id="deco" placeholder="Serial Equipo">
        <select id="plan"><option value="Prepago">Prepago</option><option value="Pospago">Pospago</option></select>
    </div>
    <button class="btn" onclick="guardar()">REGISTRAR Y SINCRONIZAR</button>

    <div class="search-box">
        <input type="text" id="buscarInput" onkeyup="filtrar()" placeholder="ðŸ” BUSCAR (Nombre, CÃ©dula o Serial)...">
    </div>

    <div style="overflow-x:auto;">
        <table id="tablaVentas">
            <thead>
                <tr><th>Fecha</th><th>Empresa</th><th>Cliente</th><th>Equipo</th><th>Estado</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
    // TU ENLACE ACTUALIZADO
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzV5AbZynKHswQ3f-_87_rOrcLuD8ghaexkzEzyLqVoQ9AuJaiOesEuHjzEXebkiBDufw/exec";
    let ventas = [];

    async function cargar() {
        document.getElementById('status').style.display = 'block';
        try {
            const r = await fetch(SCRIPT_URL + "?action=get");
            const data = await r.json();
            ventas = data.reverse();
            dibujar(ventas);
        } catch(e) { console.log(e); }
        document.getElementById('status').style.display = 'none';
    }

    function dibujar(lista) {
        const cuerpo = document.querySelector("#tablaVentas tbody");
        cuerpo.innerHTML = "";
        lista.forEach(v => {
            const emp = v.Empresa || v.empresa || "";
            const color = emp === 'DIRECTV' ? '#00A1DE' : '#ef3340';
            cuerpo.innerHTML += `<tr>
                <td>${v.FechaReg || v.fechareg || ""}</td>
                <td><span class="badge" style="background:${color}">${emp}</span></td>
                <td><b>${v.Nombre || v.nombre || ""}</b><br>CC: ${v.Cedula || v.cedula || ""}</td>
                <td>${v.Deco || v.deco || ""}</td>
                <td>${v.Estado || v.estado || "Pendiente"}</td>
            </tr>`;
        });
    }

    async function guardar() {
        const d = {
            action: "add",
            empresa: document.getElementById('empresa').value,
            cedula: document.getElementById('cedula').value,
            nombre: document.getElementById('nombre').value,
            tel: document.getElementById('tel').value,
            deco: document.getElementById('deco').value,
            plan: document.getElementById('plan').value,
            fechaReg: new Date().toLocaleString(),
            estado: "Pendiente"
        };
        
        if(!d.nombre || !d.cedula) return alert("Llena los datos");

        document.querySelector(".btn").disabled = true;
        document.querySelector(".btn").innerText = "Enviando...";

        await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(d) });
        
        setTimeout(() => {
            alert("Venta guardada");
            location.reload();
        }, 2000);
    }

    function filtrar() {
        const bus = document.getElementById("buscarInput").value.toLowerCase();
        const f = ventas.filter(v => 
            (v.Nombre || v.nombre || "").toLowerCase().includes(bus) || 
            (v.Cedula || v.cedula || "").toString().includes(bus) ||
            (v.Deco || v.deco || "").toLowerCase().includes(bus)
        );
        dibujar(f);
    }

    window.onload = cargar;
</script>
</body>
</html>
